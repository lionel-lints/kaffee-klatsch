"use strict"
var app = angular.module("homeApp", ['ngRoute', 'n3-line-chart']);

app.config(['$routeProvider', function($routeProvider) {
  $routeProvider
    .when('/', {
      controller : 'homeCtrl',
      templateUrl : "<%= asset_path('angulars/home/index.html') %>"
    });
    // .when('/signout', {
    //   controller : 'homeCtrl',
    //   templateUrl : "<%= asset_path('angulars/home/index.html') %>"
    // });
}]);
// app.service('userInitializer', function(){
//   return <%= @user.to_json.html_safe %>;
// });

app.controller('homeCtrl', ['$scope', '$http', function($scope, $http) {

  $scope.logOutUser = function() {
    $http({
      method: 'POST',
      url: '/signout'
    }).then(function successCallback(response) {
      if (response.data){
        window.location = "/";
      } else {
        console.log(response);
        console.log("user was not logged out");
      }
    });
  };
}]);

app.controller('surveyCtrl', ['$scope', '$http', function($scope, $http) {
  $scope.surveyPage = true;
  $scope.pageSwitch = function (){
    $scope.surveyPage = !$scope.surveyPage;
  };
  $scope.addSurvey = function (){
    $http({
      method: 'POST',
      url: '/users/'+ $scope.user.id + '/surveys',
      data: {
        user_id: $scope.user.id,
        emotion: parseFloat(this.emotion),
        coffees: parseInt(this.coffees)
      }
    }).then(function successCallback(response) {
      if (response.data){
        console.log(response.data);
        $scope.emotion = '';
        $scope.coffees = '';
        $scope.surveyPage = true;
        // $window.location.reload();
      } else {
        console.log(response);
        console.log("survey failed");
      }
    });
  };
}]);

app.controller('coffeeChartCtrl', ['$scope', '$http', function($scope, $http) {
  let dataMax = 0;
  $scope.data = { coffeeDataset: [] };

  for (var i = 0; i < $scope.surveys.length; i++) {
    console.log($scope.surveys[i].updated_at);
    $scope.data.coffeeDataset.push({ x: i, coffees: $scope.surveys[i].coffees});
    if ($scope.surveys[i].coffees > dataMax) {
      dataMax = $scope.surveys[i].coffees + 1;
    }
  }
  console.log($scope.data.coffeeDataset);
  $scope.options = {
       series: [
         {
           axis: "y",
           dataset: "coffeeDataset",
           key: "coffees",
           label: "Coffees over the day",
           color: "#1f77b4",
           type: ['line', 'dot'],
           id: 'mySeries0'
         }
       ],
       axes:
       {
         x: {key: "x", ticks:10, ticksShift: {y: 5, x: 0}},
         y: {min:0, max: dataMax, ticks: 5}
       },
       margin:
       {
         top: 30,
         right: 30,
         bottom: 30,
         left: 30
       },
       grid:
       {
         x: false,
         y: false
       },
       drawLegend: false
     };

}]);

app.controller('emotionChartCtrl', ['$scope', '$http', function($scope, $http) {
  let dataMax = 0;
  $scope.data = { emotionDataset: [] };
  for (var i = 0; i < $scope.surveys.length; i++) {
    $scope.data.emotionDataset.push({ x: i , emotion: $scope.surveys[i].emotion});
    if ($scope.surveys[i].emotion > dataMax) {
      dataMax = $scope.surveys[i].emotion + 1;
    }
  }
console.log($scope.data.emotionDataset);
  $scope.options = {
       series: [
         {
           axis: "y",
           dataset: "emotionDataset",
           key: "emotion",
           label: "How you've been feeling",
           color: "#1f77b4",
           type: ['line', 'dot'],
           id: 'mySeries0'
         }
       ],
       axes: {x: {key: "x", ticks:8, ticksShift: {y: 5, x: 0}}, y: {min:0, max: dataMax, ticks: 5}},
       margin:
       {
         top: 30,
         right: 30,
         bottom: 30,
         left: 30
       },
       grid:
       {
         x: false,
         y: false
       },
       drawLegend: false
     };

}]);

app.controller('tempChartCtrl', ['$scope', '$http', function($scope, $http) {
  $scope.data = {
    coffeeDataset: [
      {x: 0, val_0: 0},
      {x: 1, val_0: 0.993},
      {x: 2, val_0: 1.947},
      {x: 3, val_0: 2.823},
      {x: 4, val_0: 3.587},
      {x: 5, val_0: 4.207},
      {x: 6, val_0: 4.66},
      {x: 7, val_0: 4.927}
    ],
    emotionDataset: [
      {x: 0, val_0: 0},
      {x: 1, val_0: 0.993},
      {x: 2, val_0: 1.947},
      {x: 3, val_0: 2.823},
      {x: 4, val_0: 3.587},
      {x: 5, val_0: 4.207},
      {x: 6, val_0: 4.66},
      {x: 7, val_0: 4.927}
    ]
  };

  $scope.options = {
       series: [
         {
           axis: "y",
           dataset: "coffeeDataset",
           key: "val_0",
           label: "Coffees over the day",
           color: "#1f77b4",
           type: ['line', 'dot'],
           id: 'mySeries0'
         },
         {
           axis: "y",
           dataset: "emotionDataset",
           key: "val_0",
           label: "How you've been feeling",
           color: "#1f77b4",
           type: ['line', 'dot'],
           id: 'mySeries0'
         }
       ],
       axes: {x: {key: "x", ticks:8, ticksShift: {y: 5, x: 0}}, y: {min:0, max:5, ticks: 5}},
       margin:
       {
         top: 30,
         right: 30,
         bottom: 30,
         left: 30
       },
       grid:
       {
         x: false,
         y: false
       },
       drawLegend: false
     };

}]);
